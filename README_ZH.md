# sscontrol

> åŸºäº Rust æ„å»ºçš„æ— ç•Œé¢è¿œç¨‹æ¡Œé¢åº”ç”¨ï¼Œæ”¯æŒ WebRTC P2P é€šä¿¡ã€è·¨å¹³å°å’Œç³»ç»ŸæœåŠ¡é›†æˆã€‚

English: [README.md](README.md)

[![Rust](https://img.shields.io/badge/rust-1.70%2B-orange.svg)](https://www.rust-lang.org)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/platform-macOS%20%7C%20Windows%20%7C%20Linux-lightgrey.svg)]()

## ç®€ä»‹

sscontrol æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ— ç•Œé¢è¿œç¨‹æ¡Œé¢è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ P2P è¿æ¥å®ç°å±å¹•å…±äº«å’Œè¿œç¨‹æ§åˆ¶ã€‚å®ƒä½œä¸ºåå°æœåŠ¡è¿è¡Œï¼Œæ”¯æŒï¼š

- å±å¹•æ•è· - å¯é…ç½®å¸§ç‡çš„é«˜æ€§èƒ½æ•è·
- è¿œç¨‹è¾“å…¥æ§åˆ¶ - é¼ æ ‡å’Œé”®ç›˜æ¨¡æ‹Ÿ
- WebRTC P2P - ä½å»¶è¿Ÿç‚¹å¯¹ç‚¹è§†é¢‘ä¼ è¾“
- ç«¯åˆ°ç«¯åŠ å¯† - TLS åŠ å¯†æ”¯æŒ
- è·¨å¹³å° - æ”¯æŒ macOSã€Windowsã€Linux
- ç³»ç»ŸæœåŠ¡ - é›†æˆç³»ç»ŸæœåŠ¡ï¼ˆLaunchAgentã€systemdã€Windows Serviceï¼‰

## é¡¹ç›®çŠ¶æ€

| é˜¶æ®µ | çŠ¶æ€ | æè¿° |
| ------ | ------ | ------ |
| Phase 0 | âœ… å·²å®Œæˆ | è§„åˆ’ä¸è®¾è®¡ |
| Phase 1 | âœ… å·²å®Œæˆ | MVP å±å¹•æ•è· |
| Phase 2 | âœ… å·²å®Œæˆ | é¼ æ ‡æ§åˆ¶ |
| Phase 3 | âœ… å·²å®Œæˆ | WebRTC ä¼˜åŒ– |
| Phase 4 | âœ… å·²å®Œæˆ | å®‰å…¨ç‰¹æ€§ |
| Phase 5 | âœ… å·²å®Œæˆ | ç³»ç»ŸæœåŠ¡æ‰“åŒ… |

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- ğŸ“º å±å¹•æ•è· - ä½¿ç”¨å¹³å°åŸç”Ÿ API é«˜æ€§èƒ½æ•è·
  - macOS: CGDisplay API
  - Windows: GDI BitBlt
  - Linux: X11 (è®¡åˆ’ä¸­)
- ğŸ–±ï¸ è¿œç¨‹è¾“å…¥ - é¼ æ ‡å’Œé”®ç›˜æ§åˆ¶æ¨¡æ‹Ÿ
- ğŸŒ WebRTC - åŸºäº WebRTC æ•°æ®é€šé“çš„ P2P è§†é¢‘æµ
- ğŸ”’ å®‰å…¨æœºåˆ¶ - API å¯†é’¥è®¤è¯ã€HMAC-SHA256 ä»¤ç‰Œã€TLS æ”¯æŒ
- ğŸ“¦ æœåŠ¡æ¨¡å¼ - åœ¨æ‰€æœ‰å¹³å°ä¸Šä½œä¸ºç³»ç»ŸæœåŠ¡è¿è¡Œ

### æŠ€æœ¯äº®ç‚¹

- å½’ä¸€åŒ–åæ ‡ï¼ˆ0.0-1.0ï¼‰å®ç° DPI æ— å…³è¾“å…¥
- ç½‘ç»œæ–­çº¿è‡ªåŠ¨é‡è¿
- å¯é…ç½®å¸§ç‡å’Œåˆ†è¾¨ç‡
- H.264 ç¼–ç æ”¯æŒï¼ˆå¯é€‰ç‰¹æ€§ï¼‰
- å®Œå–„çš„æ—¥å¿—è¿½è¸ª

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Rust 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬
- å¹³å°ç‰¹å®šè¦æ±‚ï¼š
  - macOS: å±å¹•å½•åˆ¶æƒé™ï¼ˆç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§ â†’ å±å¹•å½•åˆ¶ï¼‰
  - Windows: å®‰è£…æœåŠ¡éœ€è¦ç®¡ç†å‘˜æƒé™
  - Linux: systemd ç”¨äºæœåŠ¡ç®¡ç†

### å®‰è£…

#### ä»æºç å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yourname/sscontrol.git
cd sscontrol

# æ„å»ºå‘å¸ƒç‰ˆæœ¬
cargo build --release

# ï¼ˆå¯é€‰ï¼‰å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶
sudo cp target/release/sscontrol /usr/local/bin/
```

#### ä½¿ç”¨å®‰è£…è„šæœ¬

macOS:

```bash
./scripts/install_macos.sh
```

Linux:

```bash
sudo ./scripts/install_linux.sh
```

Windows (ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell):

```powershell
.\scripts\install_windows.ps1
```

### ä½¿ç”¨æ–¹æ³•

#### åŸºæœ¬ç”¨æ³•

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®è¿è¡Œ
sscontrol

# æŒ‡å®šæœåŠ¡å™¨åœ°å€
sscontrol --server ws://localhost:8080

# è®¾ç½®è‡ªå®šä¹‰è®¾å¤‡ ID å’Œå¸§ç‡
sscontrol --device-id my-device --fps 30

# è¯¦ç»†æ—¥å¿—è¾“å‡º
sscontrol -vv
```

#### æœåŠ¡ç®¡ç†

```bash
# å®‰è£…ä¸ºç³»ç»ŸæœåŠ¡
sscontrol service install

# å¯åŠ¨æœåŠ¡
sscontrol service start

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sscontrol service status

# åœæ­¢æœåŠ¡
sscontrol service stop

# å¸è½½æœåŠ¡
sscontrol service uninstall
```

#### æœåŠ¡æ¨¡å¼ï¼ˆå‰å°è¿è¡Œï¼‰

```bash
# ä»¥æœåŠ¡æ¨¡å¼è¿è¡Œï¼ˆç”¨äº systemd/launchd é›†æˆï¼‰
sscontrol run
```

## é…ç½®

é»˜è®¤é…ç½®æ–‡ä»¶ä½äº `~/.config/sscontrol/config.toml`ã€‚

### é…ç½®ç¤ºä¾‹

```toml
[server]
# WebSocket æœåŠ¡å™¨åœ°å€
url = "ws://localhost:8080"

# è®¾å¤‡ IDï¼ˆç•™ç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆï¼‰
# device_id = ""

[capture]
# ç›®æ ‡å¸§ç‡
fps = 30

# å±å¹•ç´¢å¼•ï¼ˆ0 = ä¸»æ˜¾ç¤ºå™¨ï¼‰
# screen_index = 0

[security]
# API Keyï¼ˆæ¨èä½¿ç”¨ç¯å¢ƒå˜é‡ SSCONTROL_API_KEYï¼‰
# api_key = "your-secret-api-key"

# TLS è¯ä¹¦è·¯å¾„ï¼ˆæ¨èä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
# tls_cert = "/path/to/cert.pem"
# tls_key = "/path/to/key.pem"

# æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ TLS è¿æ¥
require_tls = false

# Token æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 300
token_ttl = 300
```

### ç¯å¢ƒå˜é‡

| å˜é‡ | æè¿° |
| ------ | ------ |
| `SSCONTROL_API_KEY` | ç”¨äºèº«ä»½è®¤è¯çš„ API å¯†é’¥ |
| `SSCONTROL_TLS_CERT` | TLS è¯ä¹¦æ–‡ä»¶è·¯å¾„ |
| `SSCONTROL_TLS_KEY` | TLS ç§é’¥æ–‡ä»¶è·¯å¾„ |

## æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä¸»æœºä»£ç†                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å±å¹•æ•è· â”‚â”€â”€â”€â†’â”‚   ç¼–ç å™¨  â”‚â”€â”€â”€â†’â”‚  ç½‘ç»œä¼ è¾“ â”‚â”€â”€â”€â†’â”‚  WebRTC  â”‚  â”‚
â”‚  â”‚ (macOS/  â”‚    â”‚ (H.264/  â”‚    â”‚(WebSocketâ”‚    â”‚ (P2P)    â”‚  â”‚
â”‚  â”‚ Windows) â”‚    â”‚  Simple) â”‚    â”‚  å®¢æˆ·ç«¯) â”‚    â”‚          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â†‘                                     â†“                    â”‚
â”‚       â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚       â”‚                            â”‚ è¾“å…¥å¤„ç†å™¨   â”‚            â”‚
â”‚       â”‚                            â”‚  (é¼ æ ‡/é”®ç›˜) â”‚            â”‚
â”‚       â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      å®‰å…¨å±‚                              â”‚   â”‚
â”‚  â”‚  (API å¯†é’¥è®¤è¯ / HMAC ä»¤ç‰Œ / TLS)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¿¡ä»¤æœåŠ¡å™¨                                  â”‚
â”‚                  (WebSocket + WebRTC ICE)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ„å»ºé€‰é¡¹

### é»˜è®¤ç‰¹æ€§

```bash
cargo build --release
```

### å¯ç”¨ H.264 ç¼–ç 

```bash
cargo build --release --features h264
```

### å¯ç”¨ WebRTC æ”¯æŒ

```bash
cargo build --release --features webrtc
```

### å¯ç”¨å®‰å…¨ç‰¹æ€§

```bash
cargo build --release --features security
```

### å¯ç”¨æ‰€æœ‰ç‰¹æ€§

```bash
cargo build --release --features "h264,webrtc,security,service"
```

## ç¤ºä¾‹ç¨‹åº

é¡¹ç›®åŒ…å«å¤šä¸ªç¤ºä¾‹ç¨‹åºï¼š

| ç¤ºä¾‹ | æè¿° | å‘½ä»¤ |
| ------ | ------ | ------ |
| `test_server` | WebSocket æµ‹è¯•æœåŠ¡å™¨ | `cargo run --example test_server` |
| `test_capture` | å±å¹•æ•è·æµ‹è¯• | `cargo run --example test_capture` |
| `test_encoder` | ç¼–ç å™¨æµ‹è¯• | `cargo run --example test_encoder` |
| `benchmark` | æ€§èƒ½åŸºå‡†æµ‹è¯• | `cargo run --example benchmark` |
| `signaling_server` | WebRTC ä¿¡ä»¤æœåŠ¡å™¨ | `cargo run --example signaling_server` |
| `webrtc_client` | WebRTC å®¢æˆ·ç«¯ç¤ºä¾‹ | `cargo run --example webrtc_client --features webrtc` |
| `secure_server` | å¸¦è®¤è¯çš„å®‰å…¨æœåŠ¡å™¨ | `cargo run --example secure_server --features security` |

## æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¾“å‡º
cargo test -- --nocapture

# è¿è¡Œç‰¹å®šæµ‹è¯•æ¨¡å—
cargo test capture::tests
```

## æ€§èƒ½

æµ‹è¯•ç¯å¢ƒï¼šmacOSï¼Œ4K åˆ†è¾¨ç‡ï¼ˆ3840Ã—2160ï¼‰

| æŒ‡æ ‡ | ç»“æœ |
| ------ | ------ |
| å¹³å‡æ•è·æ—¶é—´ | ~51 ms |
| å¹³å‡ç¼–ç æ—¶é—´ | ~1.6 ms |
| æœ€å¤§å¸§ç‡ | ~19 FPSï¼ˆæœªä¼˜åŒ–ï¼‰ |
| å¸¦å®½å ç”¨ï¼ˆåŸå§‹ï¼‰ | ~600 MB/s |

> æ³¨æ„ï¼šå¯ç”¨ H.264 ç¼–ç å¯æ˜¾è‘—é™ä½å¸¦å®½éœ€æ±‚ã€‚

## æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ |
| ------ | ------ |
| è¯­è¨€ | Rust 2021 |
| è¿è¡Œæ—¶ | Tokioï¼ˆå¼‚æ­¥ï¼‰ |
| ç½‘ç»œ | tokio-tungstenite (WebSocket)ã€webrtc-rs 0.12 |
| ç¼–ç  | SimpleEncoderã€H.264ï¼ˆå¯é€‰ï¼‰ |
| å®‰å…¨ | HMAC-SHA256ã€rustlsï¼ˆTLSï¼‰ |
| macOS API | CGDisplayã€Core Graphicsã€CGEvent |
| Windows API | GDIã€SendInputã€Windows Service |

## æ–‡æ¡£

| æ–‡æ¡£ | æè¿° |
| ------ | ------ |
| [æ¶æ„è®¾è®¡](./docs/architecture/overview.md) | ç³»ç»Ÿæ¶æ„å’Œæ¨¡å—è®¾è®¡ |
| [ç¯å¢ƒæ­å»º](./docs/implementation/setup.md) | å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å— |
| [å¼€å‘è·¯çº¿å›¾](./docs/roadmap.md) | å®Œæ•´çš„å¼€å‘è§„åˆ’ |
| [é¡¹ç›®è¿›åº¦](./docs/progress.md) | è¯¦ç»†çš„é¡¹ç›®è¿›åº¦ |
| [å¸¸è§é—®é¢˜](./docs/troubleshooting/common-issues.md) | é—®é¢˜æ’æŸ¥æŒ‡å— |

## å·²çŸ¥é—®é¢˜

| ID | é—®é¢˜æè¿° | ä¼˜å…ˆçº§ |
| ---- | --------- | -------- |
| T001 | H.264 ç¼–ç å™¨é»˜è®¤æœªå¯ç”¨ | P1 |
| T002 | macOS æ»šè½®äº‹ä»¶æ”¯æŒæœ‰é™ | P3 |
| T003 | Windows ä½¿ç”¨ GDI æ•è·ï¼ˆé Desktop Duplication APIï¼‰ | P3 |

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

## å¼€å‘

```bash
# æ ¼å¼åŒ–ä»£ç 
cargo fmt

# è¿è¡Œä»£ç æ£€æŸ¥
cargo clippy

# æ„å»ºæ–‡æ¡£
cargo doc --open
```

## å¼€æºè®¸å¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è‡´è°¢

- æ„å»ºå·¥å…·ï¼š[Rust](https://www.rust-lang.org/)
- WebRTC å®ç°ï¼š[webrtc-rs](https://github.com/webrtc-rs/webrtc)
- å¼‚æ­¥è¿è¡Œæ—¶ï¼š[Tokio](https://tokio.rs/)
